<template>
  <div class="min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 p-4 md:p-8">
    <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
      <!-- Header Section -->
      <div class="bg-blue-600 px-6 py-4">
        <h1 class="text-2xl md:text-3xl font-bold text-white text-center">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ</h1>
      </div>

      <div class="p-6 md:p-8">
        <!-- Form Section -->
        <div class="mb-10">
          <h2 class="text-xl font-semibold mb-6 text-gray-800 border-b pb-2">{{ editMode ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ' :
            '‡∏≠‡∏≠‡∏Å‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà' }}</h2>

          <form @submit.prevent="handleSubmit" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Form Inputs -->
            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ <span
                  class="text-red-500">*</span></label>
              <input v-model="form.plateNumber"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                type="text" placeholder="XX-1234" required />
            </div>

            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö <span
                  class="text-red-500">*</span></label>
              <input v-model="form.driverName"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                type="text" required />
            </div>

            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">‡∏™‡∏µ‡∏£‡∏ñ <span class="text-red-500">*</span></label>
              <input v-model="form.carColor"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                type="text" required />
            </div>

            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ <span
                  class="text-red-500">*</span></label>
              <select v-model="form.carType"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                required>
                <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</option>
                <option>‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</option>
                <option>‡∏°‡∏≠‡πÑ‡∏ã</option>
                <option>‡∏£‡∏ñ‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å</option>
              </select>
            </div>

            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ <span
                  class="text-red-500">*</span></label>
              <input v-model="form.entryTime"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                type="datetime-local" required />
            </div>

            <div class="space-y-2">
              <label class="block text-sm font-medium text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</label>
              <input v-model="form.exitTime"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
                type="datetime-local" />
            </div>

            <!-- Submit Button -->
            <div class="md:col-span-2 flex justify-end mt-4">
              <button type="submit"
                class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition flex items-center">
                <svg v-if="!editMode" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                  fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"
                    clip-rule="evenodd" />
                </svg>
                <svg v-else xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20"
                  fill="currentColor">
                  <path
                    d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                </svg>
                {{ editMode ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' }}
              </button>
            </div>
          </form>
        </div>

        <!-- Parking Preview -->
        <div v-if="form.plateNumber" class="mb-10">
          <h2 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ</h2>
          <div class="border border-gray-200 rounded-xl p-6 bg-gradient-to-r from-blue-50 to-gray-50 shadow-inner">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="space-y-3">
                <p class="flex items-center">
                  <span class="inline-block w-24 font-medium text-gray-700">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô:</span>
                  <span class="font-semibold text-blue-600">{{ form.plateNumber || '-' }}</span>
                </p>
                <p class="flex items-center">
                  <span class="inline-block w-24 font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö:</span>
                  <span class="font-semibold">{{ form.driverName || '-' }}</span>
                </p>
                <p class="flex items-center">
                  <span class="inline-block w-24 font-medium text-gray-700">‡∏™‡∏µ‡∏£‡∏ñ:</span>
                  <span class="font-semibold">{{ form.carColor || '-' }}</span>
                </p>
              </div>
              <div class="space-y-3">
                <p class="flex items-center">
                  <span class="inline-block w-24 font-medium text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ:</span>
                  <span class="font-semibold">{{ form.carType || '-' }}</span>
                </p>
                <p class="flex items-center">
                  <span class="inline-block w-24 font-medium text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤:</span>
                  <span class="font-semibold">{{ formatDateTime(form.entryTime) || '-' }}</span>
                </p>
                <p class="flex items-center">
                  <span class="inline-block w-24 font-medium text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å:</span>
                  <span class="font-semibold">{{ formatDateTime(form.exitTime) || '-' }}</span>
                </p>
              </div>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-200">
              <p class="flex items-center">
                <span class="inline-block w-24 font-medium text-gray-700">‡∏£‡∏≤‡∏Ñ‡∏≤:</span>
                <span class="font-semibold text-green-600">
                  {{
                    form.carType.toLowerCase() === '‡∏°‡∏≠‡πÑ‡∏ã' || form.carType.toLowerCase() === 'motorcycle'
                      ? '‡∏ô‡∏≤‡∏ó‡∏µ‡∏•‡∏∞ 1.5 ‡∏ö‡∏≤‡∏ó'
                      : form.carType.toLowerCase() === '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå' || form.carType.toLowerCase() === 'car'
                        ? '‡∏ô‡∏≤‡∏ó‡∏µ‡∏•‡∏∞ 2.0 ‡∏ö‡∏≤‡∏ó'
                        : form.carType.toLowerCase() === '‡∏£‡∏ñ‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å' || form.carType.toLowerCase() === 'truck'
                          ? '‡∏ô‡∏≤‡∏ó‡∏µ‡∏•‡∏∞ 3.0 ‡∏ö‡∏≤‡∏ó'
                          : '‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ'
                  }}
                </span>
              </p>
            </div>
          </div>
        </div>

        <!-- Parking Passes List -->
        <div v-if="parkingPasses.length > 0">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ</h2>
            <span class="text-sm text-gray-500">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {{ parkingPasses.length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
          </div>

          <div class="overflow-x-auto rounded-lg border border-gray-200 shadow">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ
                  </th>
                  <th scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö
                  </th>
                  <th scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</th>
                  <th scope="col"
                  class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏µ‡∏£‡∏ñ</th>
                  <th scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</th>
                  <th scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</th>
                  <th scope="col"
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                  <th scope="col"
                    class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr v-for="(parkingPass, index) in parkingPasses" :key="index" class="hover:bg-gray-50 transition">
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="font-medium text-blue-600">{{ parkingPass.plateNumber }}</div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-gray-900">{{ parkingPass.driverName }}</div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full" :class="{
                      'bg-green-100 text-green-800': parkingPass.carType === '‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå',
                      'bg-blue-100 text-blue-800': parkingPass.carType === '‡∏°‡∏≠‡πÑ‡∏ã',
                      'bg-purple-100 text-purple-800': parkingPass.carType === '‡∏£‡∏ñ‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å'
                    }">
                      {{ parkingPass.carType }}
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {{ parkingPass.carColor }}
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {{ formatDateTime(parkingPass.entryTime) }}
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {{ formatDateTime(parkingPass.exitTime) || '-' }}
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-green-600">
                    {{ parkingPass.price }}
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button @click="handleEdit(parkingPass.id)"
                      class="text-yellow-600 hover:text-yellow-900 mr-3 inline-flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path
                          d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                      </svg>
                      ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                    <button @click="handleDelete(parkingPass.id)"
                      class="text-red-600 hover:text-red-900 inline-flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                          d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                          clip-rule="evenodd" />
                      </svg>
                      ‡∏•‡∏ö
                    </button>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡∏°‡∏û‡πå -->
                    <button @click="printTicket(parkingPass)"
                      class="text-blue-600 hover:text-blue-900 mr-3 inline-flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                          d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z"
                          clip-rule="evenodd" />
                      </svg>
                      ‡∏û‡∏¥‡∏°‡∏û‡πå
                    </button>
                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÜ... -->
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà) -->
        <div v-if="printData" ref="printContent" class="hidden print:block p-6">
          <div class="border-2 border-gray-800 rounded-lg p-6 max-w-md mx-auto">
            <h2 class="text-xl font-bold text-center mb-4">‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ</h2>
            <div class="grid grid-cols-2 gap-4 mb-6">
              <div>
                <p class="text-sm text-gray-600">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</p>
                <p class="font-bold">{{ printData.plateNumber }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö</p>
                <p class="font-bold">{{ printData.driverName }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">‡∏™‡∏µ‡∏£‡∏ñ</p>
                <p class="font-bold">{{ printData.carColor }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ</p>
                <p class="font-bold">{{ printData.carType }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</p>
                <p class="font-bold">{{ formatDateTime(printData.entryTime) }}</p>
              </div>
              <div>
                <p class="text-sm text-gray-600">‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</p>
                <p class="font-bold">{{ printData.exitTime ? formatDateTime(printData.exitTime) : '-' }}</p>
              </div>
            </div>
            <div class="border-t-2 border-gray-300 pt-4">
              <p class="text-lg font-bold text-right">‡∏£‡∏≤‡∏Ñ‡∏≤: {{ printData.price }} ‡∏ö‡∏≤‡∏ó</p>
            </div>
            <div class="mt-8 text-center text-xs text-gray-500">
              <p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
              <p>{{ formatDateTime(new Date().toISOString()) }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">

import axios from 'axios'
import { ref, nextTick } from 'vue'

const printData = ref<any>(null)
const printContent = ref<HTMLElement | null>(null)

const formatDateTime = (dateTimeString: string) => {
  if (!dateTimeString) return '-'
  const date = new Date(dateTimeString)
  const day = date.getDate().toString().padStart(2, '0')
  const month = (date.getMonth() + 1).toString().padStart(2, '0')
  const year = date.getFullYear().toString().slice(-2)
  const hours = date.getHours().toString().padStart(2, '0')
  const minutes = date.getMinutes().toString().padStart(2, '0')
  return `${day}-${month}-${year} ${hours}:${minutes}`
}

const printTicket = (parkingPass: any) => {
  printData.value = parkingPass
  
  nextTick(() => {
    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå
    window.print()
  })
}
// ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
const form = ref({
  plateNumber: '',
  driverName: '',
  carColor: '',
  carType: '',
  entryTime: '',
  exitTime: '',
})

const parkingPasses = ref([])
const editMode = ref(false)
const currentId = ref<number | null>(null)




// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
const fetchParkingPasses = async () => {
  try {
    const response = await axios.get('http://localhost:5285/api/parkingpass')
    parkingPasses.value = response.data
  } catch (err) {
    console.error(err)
    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏≠‡∏î‡∏£‡∏ñ‡πÑ‡∏î‡πâ')
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
const handleSubmit = async () => {
  try {
    const dataToSend = editMode.value
      ? {
        Id: currentId.value, // <-- ‡πÉ‡∏™‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        PlateNumber: form.value.plateNumber,
        DriverName: form.value.driverName,
        CarColor: form.value.carColor,
        CarType: form.value.carType,
        EntryTime: form.value.entryTime,
        ExitTime: form.value.exitTime,
      }
      : {
        PlateNumber: form.value.plateNumber,
        DriverName: form.value.driverName,
        CarColor: form.value.carColor,
        CarType: form.value.carType,
        EntryTime: form.value.entryTime,
        ExitTime: form.value.exitTime,
      };



    console.log('üëâ ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà API:', dataToSend)



    if (editMode.value) {
      // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç, ‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ PUT (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï)
      await axios.put(`http://localhost:5285/api/parkingpass/${currentId.value}`, dataToSend, {
        headers: { 'Content-Type': 'application/json' }
      });

      alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
    } else {
      await axios.post('http://localhost:5285/api/parkingpass', dataToSend, {
        headers: {
          'Content-Type': 'application/json'
        }
      });
    }

    // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    fetchParkingPasses();

    resetForm();
  } catch (err) {
    console.error('Error occurred:', err);
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
const handleEdit = (id: number) => {
  const parkingPass = parkingPasses.value.find(p => p.id === id);
  if (parkingPass) {
    form.value.plateNumber = parkingPass.plateNumber;
    form.value.driverName = parkingPass.driverName;
    form.value.carColor = parkingPass.carColor;
    form.value.carType = parkingPass.carType;
    form.value.entryTime = parkingPass.entryTime
    form.value.exitTime = parkingPass.exitTime



    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö ID ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    editMode.value = true;
    currentId.value = id;
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
const handleDelete = async (id: number) => {
  if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) {
    try {
      await axios.delete(`http://localhost:5285/api/parkingpass/${id}`);
      alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
      fetchParkingPasses(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
    } catch (err) {
      console.error(err);
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö');
    }
  }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
const resetForm = () => {
  form.value.plateNumber = '';
  form.value.driverName = '';
  form.value.carColor = '';
  form.value.carType = '';

  form.value.entryTime = ''
  form.value.exitTime = ''

  editMode.value = false;
  currentId.value = null;
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
fetchParkingPasses();

</script>

<style scoped>
/* ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ */
@media print {
  body * {
    visibility: hidden;
  }
  .print\:block, .print\:block * {
    visibility: visible;
  }
  .print\:block {
    position: fixed;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background: white;
    z-index: 9999;
  }
}
</style>